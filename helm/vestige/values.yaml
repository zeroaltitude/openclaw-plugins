# Default values for vestige

replicaCount: 1

image:
  repository: ""  # e.g. 123456789.dkr.ecr.us-west-2.amazonaws.com/vestige
  tag: "latest"
  pullPolicy: IfNotPresent

imagePullSecrets: []

service:
  type: ClusterIP
  port: 8000

ingress:
  enabled: true
  className: alb
  # Optional: ARN of the ACM certificate for ALB HTTPS termination
  # certificateArn: "arn:aws:acm:us-west-2:123456789:certificate/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
  certificateArn: ""
  annotations:
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internal
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS":443}]'
    alb.ingress.kubernetes.io/healthcheck-path: /health
  hosts:
    - host: vestige.internal
      paths:
        - path: /
          pathType: Prefix

resources:
  requests:
    cpu: 250m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi

persistence:
  enabled: true
  storageClass: gp3
  accessModes:
    - ReadWriteOnce
  size: 5Gi
  mountPath: /data

env:
  LOG_LEVEL: info
  VESTIGE_DATA_DIR: /data
  VESTIGE_BINARY: vestige-mcp
  # Embedding model cache — must be on PVC so it persists across restarts
  FASTEMBED_CACHE_PATH: /data/.cache/vestige/fastembed

# Auth token — REQUIRED for production deployments.
# Either set auth.token via --set or provide auth.existingSecret.
# Leaving both empty will cause the secret template to fail at deploy time.
# For local dev without auth, set env var VESTIGE_ALLOW_ANONYMOUS=true.
auth:
  existingSecret: ""   # Use an existing k8s secret name
  secretKey: token     # Key within the secret
  token: ""            # Inline token (not recommended for prod)

probes:
  liveness:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 30
    periodSeconds: 30
    timeoutSeconds: 5
    failureThreshold: 3
  readiness:
    httpGet:
      path: /readyz
      port: http
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  # Startup probe: gives up to 5 minutes for initial model download
  startup:
    httpGet:
      path: /health
      port: http
    failureThreshold: 30
    periodSeconds: 10

nodeSelector: {}
tolerations: []
affinity: {}
